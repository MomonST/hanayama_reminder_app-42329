<div class="notification-popup">
  <div class="alert alert-info border-0 shadow-lg" style="background: linear-gradient(135deg, #fce7f3, #dcfce7);">
    <div class="d-flex justify-content-between align-items-start">
      <div class="d-flex align-items-center">
        <div class="me-3">
          <i class="bi bi-bell-fill text-pink" style="font-size: 1.5rem;"></i>
        </div>
        <div>
          <h6 class="mb-1 fw-bold text-dark">ğŸŒ¸ é–‹èŠ±ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</h6>
          <p class="mb-0 small text-muted">
            ç™»éŒ²ã™ã‚‹ã¨è¦‹é ƒã®1ãƒ¶æœˆå‰ã«ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ï¼
          </p>
        </div>
      </div>
      <button type="button" class="btn-close" onclick="this.closest('.notification-popup').style.display='none'"></button>
    </div>
    <div class="mt-3">
      <%= link_to "ä»Šã™ãç™»éŒ²", new_user_registration_path, class: "btn btn-pink btn-sm me-2" %>
      <button type="button" class="btn btn-outline-secondary btn-sm" onclick="this.closest('.notification-popup').style.display='none'">
        å¾Œã§
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('turbo:load', () => {
    const notificationPopup = document.querySelector('.notification-popup');
    const closeButton = notificationPopup.querySelector('.btn-close');
    const laterButton = notificationPopup.querySelector('.btn-outline-secondary');
    const registerButton = notificationPopup.querySelector('.btn-pink'); // ä»Šã™ãç™»éŒ²ãƒœã‚¿ãƒ³

    // Cookieã‹ã‚‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for(let i=0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // Cookieã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ä¿å­˜
    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "")  + expires + "; path=/";
    }

    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function showPopup() {
      notificationPopup.style.display = 'block';
      notificationPopup.classList.add('fade-in-up'); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
    }

    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’éè¡¨ç¤ºã«ã™ã‚‹é–¢æ•°
    function hidePopup() {
      notificationPopup.style.display = 'none';
      notificationPopup.classList.remove('fade-in-up');
    }

    // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
    if (getCookie('notification_popup_shown') !== 'true') {
      showPopup();
      setCookie('notification_popup_shown', 'true', 30); // 30æ—¥é–“è¡¨ç¤ºã—ãªã„
    } else {
      hidePopup(); // CookieãŒã‚ã‚‹å ´åˆã¯éè¡¨ç¤º
    }

    // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    closeButton.addEventListener('click', () => {
      hidePopup();
      // å¿…è¦ã§ã‚ã‚Œã°Cookieã§é–‰ã˜ãŸçŠ¶æ…‹ã‚’ä¿å­˜
      // setCookie('notification_popup_closed', 'true', 30);
    });

    // å¾Œã§ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    laterButton.addEventListener('click', () => {
      hidePopup();
      // å¿…è¦ã§ã‚ã‚Œã°Cookieã§é–‰ã˜ãŸçŠ¶æ…‹ã‚’ä¿å­˜
      // setCookie('notification_popup_closed', 'true', 30);
    });

    // ä»Šã™ãç™»éŒ²ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
    registerButton.addEventListener('click', () => {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹ã®ã§ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¯éè¡¨ç¤ºã«ã™ã‚‹
      hidePopup();
    });
  });
</script>